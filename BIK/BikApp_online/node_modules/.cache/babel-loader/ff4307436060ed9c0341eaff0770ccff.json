{"ast":null,"code":"import { useState, useEffect } from 'react';\nimport fire from '../config/fire';\nimport * as Firebase from 'firebase/app';\nimport History from './History';\nexport default (() => {\n  const [products, setProducts] = useState([]);\n  const [filteredProducts, setfilteredProducts] = useState([]);\n  const [cartItems, setCartItems] = useState([]);\n  const [search, setSearch] = useState(\"\");\n  const [usrLogin, setUsr_Login] = useState(\"\");\n  const [pwdLogin, setPwd_Login] = useState(\"\");\n  const [cnfPwdLogin, setCnfPwd_Login] = useState(\"\");\n  const [guestCart, setGuestCart] = useState([]);\n  const [user, setUser] = useState({});\n  const [billAddress, setBillAddress] = useState({\n    fullName: '',\n    address1: '',\n    address2: '',\n    city: '',\n    cityState: '',\n    country: '',\n    pincode: ''\n  });\n  const [orders, setOrders] = useState([]);\n  const [env] = useState('sandbox');\n  const [currency] = useState('USD');\n  const [client] = useState({\n    sandbox: 'ATKphVPUKrAFnWXr042hYQsynmg9U_UUeudlf1RjYkyKf3rsf5s3IE-H1QZWn8ziKEZzq5WH4TRalZR_',\n    production: 'YOUR-PRODUCTION-APP-ID'\n  });\n  const db = fire.firestore(); //Products\n\n  useEffect(() => {\n    db.collection('products').get().then(response => {\n      const data = response.docs.map(doc => {\n        const productData = doc.data();\n        productData.id = doc.id;\n        return productData;\n      });\n      setProducts(data);\n      setfilteredProducts(data);\n    });\n    return () => {};\n  }, [db]);\n  useEffect(() => {\n    const unsubscribe = fire.auth().onAuthStateChanged(user => {\n      if (user) {\n        setUser({\n          userId: user.uid,\n          email: user.email\n        });\n        let userCartItem = db.collection(\"User\").doc(user.uid);\n        let orders = db.collection('Orders/').doc(user.uid);\n        userCartItem.get().then(function (doc) {\n          if (doc.exists) {\n            setCartItems(doc.data().cartItems);\n          }\n        }).catch(function (error) {\n          console.log(\"Error getting document:\", error);\n        });\n        orders.get().then(function (doc) {\n          if (doc.exists) {\n            setOrders(doc.data().cartItems);\n          }\n        }).catch(function (error) {\n          console.log(\"Error getting document:\", error);\n        });\n      } else {\n        fire.auth().signInAnonymously();\n      }\n    });\n    return () => {\n      unsubscribe();\n    };\n  }, [db]); //Search \n\n  useEffect(() => {\n    setfilteredProducts([...products].filter(product => {\n      return product.title.toLowerCase().includes(search.toLowerCase());\n    }));\n    return () => {};\n  }, [search, products]);\n  useEffect(() => {\n    if (user.email === null) setGuestCart(cartItems);\n    return () => {};\n  }, [cartItems, user.email]);\n\n  let resultFilter = (temp1, temp2) => {\n    return temp1.filter(temp1 => !temp2.some(temp2 => temp1.id === temp2.id));\n  };\n\n  console.log(env, orders, \"asd\");\n  return {\n    filteredProducts: filteredProducts,\n    cartItems: cartItems,\n    search: search,\n    orders: orders,\n    env: env,\n    currency: currency,\n    client: client,\n    onAddCart: async product => {\n      const cartItem = cartItems;\n      let productAlreadyInCart = false;\n      cartItem.forEach(item => {\n        if (item.id === product.id) {\n          productAlreadyInCart = true;\n          item.count++;\n        }\n      });\n\n      if (!productAlreadyInCart) {\n        cartItem.push({ ...product,\n          count: 1\n        });\n      }\n\n      setCartItems([...cartItem]);\n      if (user.userId !== null) await db.collection('User/').doc(user.userId).set({\n        cartItems: cartItem\n      });\n    },\n    handleSearch: value => {\n      setSearch(value);\n    },\n    handleChangeSort: sort => {\n      if (sort !== '') {\n        const updated = [...products].sort((a, b) => {\n          return sort === \"lowest\" ? a.price > b.price ? 1 : -1 : a.price < b.price ? 1 : -1;\n        });\n        setfilteredProducts(updated);\n      } else {\n        const updated = [...products].sort((a, b) => {\n          return a.id < b.id ? 1 : -1;\n        });\n        setfilteredProducts(updated);\n      }\n    },\n    onRemoveCart: async removeItem => {\n      const update = [...cartItems].filter(item => {\n        if (item.id === removeItem.id && removeItem.count <= 1) return false;else {\n          if (item.id === removeItem.id && removeItem.count > 1) item.count--;\n          return true;\n        }\n      });\n      setCartItems(update);\n      if (user.userId !== null) await db.collection('User/').doc(user.userId).update({\n        cartItems: update\n      });\n    },\n    userLoginChange: value => {\n      setUsr_Login(value);\n    },\n    pwdLoginChange: value => {\n      setPwd_Login(value);\n    },\n    cnfPwdLoginChange: value => {\n      setCnfPwd_Login(value);\n    },\n    buy: e => {\n      History.push('/products');\n    },\n    login: e => {\n      e.preventDefault();\n      fire.auth().signInWithEmailAndPassword(usrLogin, pwdLogin).then(res => {\n        if (res) {\n          let userCartItem = db.collection(\"User\").doc(res.user.uid);\n          userCartItem.get().then(function (doc) {\n            if (doc.exists) {\n              let upc = doc.data().cartItems;\n\n              if (user.email === null) {\n                let update = [];\n                upc.forEach(function (cartItem) {\n                  guestCart.forEach(function (guestCar) {\n                    if (cartItem.title === guestCar.title) {\n                      guestCar.count = cartItem.count + guestCar.count;\n                      update.push(guestCar);\n                    }\n                  });\n                });\n                resultFilter(upc, guestCart).forEach(function (val) {\n                  update.push(val);\n                });\n                resultFilter(guestCart, upc).forEach(function (val) {\n                  update.push(val);\n                });\n                db.collection('User/').doc(res.user.uid).set({\n                  cartItems: update\n                });\n                History.push('/');\n              }\n            }\n          }).catch(function (error) {\n            console.log(\"Error getting document:\", error);\n          });\n        }\n      }).catch(err => {\n        console.log(err);\n      });\n    },\n    signUp: e => {\n      e.preventDefault();\n\n      if (pwdLogin === cnfPwdLogin) {\n        if (user.email !== null) {\n          fire.auth().createUserWithEmailAndPassword(usrLogin, pwdLogin).then(res => {\n            if (res) {\n              History.push('/products');\n            }\n          }).catch(err => {\n            console.log(err);\n          });\n        } else {\n          const cred = Firebase.auth.EmailAuthProvider.credential(usrLogin, pwdLogin);\n          Firebase.auth().currentUser.linkWithCredential(cred);\n          History.push('/products');\n          setUser({ ...user,\n            email: usrLogin\n          });\n        }\n      } else {\n        alert(\"pwd not match\");\n      }\n    },\n    logout: () => {\n      fire.auth().signOut();\n      setCartItems([]);\n    },\n    user: user,\n    saveAddress: (value, field) => {\n      setBillAddress({ ...billAddress,\n        [field]: value\n      });\n    },\n    submitAddress: e => {\n      e.preventDefault();\n      db.collection('billingAddress/').doc(user.userId).set({\n        billAddress\n      });\n    },\n    billAddress: billAddress,\n    transcationSuccess: data => {\n      db.collection('Orders/').doc(user.userId).set({\n        cartItems: cartItems,\n        paymentDetails: data\n      }).then(function () {\n        db.collection('User/').doc(user.userId).set({\n          cartItems: []\n        });\n        setCartItems([]);\n        History.push(\"/orderConfirmation\");\n      }).catch(function (error) {\n        console.log(\"Error writing document: \", error);\n      });\n    },\n    transcationError: () => {\n      console.log(\"transaction failed\");\n    },\n    transcationCancelled: () => {\n      console.log(\"transaction cancelled\");\n    },\n    onCheckout: e => {\n      History.push(\"/checkout\");\n    }\n  };\n});","map":{"version":3,"sources":["/Users/graj/projects/e-commerece/src/components/useProducts.js"],"names":["useState","useEffect","fire","Firebase","History","products","setProducts","filteredProducts","setfilteredProducts","cartItems","setCartItems","search","setSearch","usrLogin","setUsr_Login","pwdLogin","setPwd_Login","cnfPwdLogin","setCnfPwd_Login","guestCart","setGuestCart","user","setUser","billAddress","setBillAddress","fullName","address1","address2","city","cityState","country","pincode","orders","setOrders","env","currency","client","sandbox","production","db","firestore","collection","get","then","response","data","docs","map","doc","productData","id","unsubscribe","auth","onAuthStateChanged","userId","uid","email","userCartItem","exists","catch","error","console","log","signInAnonymously","filter","product","title","toLowerCase","includes","resultFilter","temp1","temp2","some","onAddCart","cartItem","productAlreadyInCart","forEach","item","count","push","set","handleSearch","value","handleChangeSort","sort","updated","a","b","price","onRemoveCart","removeItem","update","userLoginChange","pwdLoginChange","cnfPwdLoginChange","buy","e","login","preventDefault","signInWithEmailAndPassword","res","upc","guestCar","val","err","signUp","createUserWithEmailAndPassword","cred","EmailAuthProvider","credential","currentUser","linkWithCredential","alert","logout","signOut","saveAddress","field","submitAddress","transcationSuccess","paymentDetails","transcationError","transcationCancelled","onCheckout"],"mappings":"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","sourcesContent":["import {useState,useEffect} from 'react';\nimport fire from '../config/fire';\nimport * as Firebase from 'firebase/app';\nimport History from './History';\n\n\n\nexport default () => {\n\n  const [products,setProducts] = useState([])\n  const [filteredProducts,setfilteredProducts] = useState([])\n  const [cartItems,setCartItems] = useState([])\n  const [search, setSearch] = useState(\"\");\n  const [usrLogin,setUsr_Login] = useState(\"\");\n  const [pwdLogin,setPwd_Login] = useState(\"\");\n  const [cnfPwdLogin,setCnfPwd_Login] = useState(\"\");\n  const [guestCart,setGuestCart] = useState([]);\n  const [user,setUser] = useState({});\n  const [billAddress,setBillAddress] = useState({\n                                                    fullName:'',\n                                                    address1:'',\n                                                    address2:'',\n                                                    city:'',\n                                                    cityState:'',\n                                                    country:'',\n                                                    pincode:''\n                                                });\n    const [orders,setOrders] = useState([]);\n    const [env] = useState('sandbox');\n    const [currency] = useState('USD');\n    const [client] = useState({\n        sandbox:    'ATKphVPUKrAFnWXr042hYQsynmg9U_UUeudlf1RjYkyKf3rsf5s3IE-H1QZWn8ziKEZzq5WH4TRalZR_',\n        production: 'YOUR-PRODUCTION-APP-ID',\n    })\n    \n   \n\n\n  const db = fire.firestore();\n\n\n    //Products\n    useEffect(() => {\n        db.collection('products')\n        .get()\n        .then(response => {\n            const data = response.docs.map(doc => {\n                const productData = doc.data();\n                productData.id=doc.id;\n                return productData\n            });\n                setProducts(data)\n                setfilteredProducts(data)\n            })\n         return () => {\n    \n        }\n    }, [db]);\n\n\n    useEffect(() => {\n\n       const unsubscribe = fire.auth().onAuthStateChanged((user)=>{\n         if(user)\n            {\n            setUser({userId:user.uid,email:user.email})\n\n            let userCartItem = db.collection(\"User\").doc(user.uid);\n            let orders = db.collection('Orders/').doc(user.uid);\n\n            userCartItem.get().then(function(doc) {\n                if (doc.exists) {\n                        setCartItems(doc.data().cartItems);\n                } \n            }).catch(function(error) {\n                console.log(\"Error getting document:\", error);\n            });\n\n            orders.get().then(function(doc) {\n                if (doc.exists) {\n                        setOrders(doc.data().cartItems);\n                } \n            }).catch(function(error) {\n                console.log(\"Error getting document:\", error);\n            });\n\n            }\n            else{\n             fire.auth().signInAnonymously()\n                 \n            }\n       \n          })\n          return () => { \n              unsubscribe();\n          }\n      }, [db])\n\n\n        //Search \n        useEffect(() => {\n            setfilteredProducts(\n                    [...products].filter(product => {\n                        return product.title.toLowerCase().includes(search.toLowerCase());\n                    })\n            )\n            return () => {\n\n            };\n        }, [search,products])\n\n  \n     useEffect(() => {\n        \n         if(user.email===null)\n            setGuestCart(cartItems)\n         return () => {\n       \n         }\n     }, [cartItems,user.email])\n\n\n     let resultFilter = (temp1, temp2) => {\n        return temp1.filter(temp1 =>\n          !temp2.some(\n            temp2 => temp1.id === temp2.id\n          )\n        );\n      };\n\n      console.log(env,orders,\"asd\")\n\n\n      \nreturn{\n    filteredProducts:filteredProducts,\n    cartItems:cartItems,\n    search:search,\n    orders:orders,\n    env:env,\n    currency:currency,\n    client:client,\n\n    onAddCart : async(product) => {\n            const cartItem = cartItems;\n            let productAlreadyInCart = false;\n            cartItem.forEach(item => {\n                if(item.id===product.id){\n                    productAlreadyInCart  = true;\n                    item.count++;\n                }\n            })\n            if(!productAlreadyInCart){\n                cartItem.push({...product,count:1})\n            }\n            setCartItems([...cartItem])\n            if(user.userId!==null)\n                await db.collection('User/').doc(user.userId).set({cartItems:cartItem});\n    },\n      handleSearch : (value) => {\n        setSearch(value);\n      },\n\n      handleChangeSort : (sort) => {\n        if(sort!==''){\n            const updated =  [...products].sort((a,b) => {\n              return (sort===\"lowest\")?(a.price > b.price?1:-1):(a.price < b.price?1:-1);\n            });\n            setfilteredProducts(updated);\n        }\n        else{\n          const updated = [...products].sort((a,b)=> { return (a.id < b.id ?1:-1)});\n          setfilteredProducts(updated);\n        }\n      },\n\n      onRemoveCart : async (removeItem) => {\n            const update =  [...cartItems].filter(item => {\n                    if(item.id===removeItem.id && removeItem.count<=1)\n                    return false;\n                    else{\n                    if(item.id===removeItem.id && removeItem.count>1)\n                        item.count--;\n                    return true;\n                    }\n                });\n                setCartItems(update);\n                if(user.userId!==null)\n                    await db.collection('User/').doc(user.userId).update({cartItems:update});\n      },\n\n      userLoginChange:(value) => {\n          setUsr_Login(value);\n      },\n\n      pwdLoginChange:(value) =>{\n          setPwd_Login(value)\n      },\n\n      cnfPwdLoginChange:(value) => {\n          setCnfPwd_Login(value)\n      },\n      buy:(e) => {\n          History.push('/products');\n      },\n\n      login: (e)=>{\n          e.preventDefault();\n            fire.auth().signInWithEmailAndPassword(usrLogin,pwdLogin).then((res)=>{\n                if(res){\n                    let userCartItem = db.collection(\"User\").doc(res.user.uid);\n                    userCartItem.get().then(function(doc) {\n                        if (doc.exists) {\n                            \n                            let upc = doc.data().cartItems;\n                            \n                        if(user.email===null){\n                            let update = []\n                            upc.forEach(function(cartItem){\n                                guestCart.forEach(function(guestCar){\n                                    if(cartItem.title===guestCar.title){\n                                                 guestCar.count = cartItem.count + guestCar.count;\n                                                 update.push(guestCar);\n                                         }\n                                            })\n                                        })\n                                        resultFilter(upc,guestCart).forEach(function(val){\n                                            update.push(val)\n                                        })\n                                        resultFilter(guestCart,upc).forEach(function(val){\n                                            update.push(val)\n                                        })\n                            db.collection('User/').doc(res.user.uid).set({cartItems:update});\n                            History.push('/');\n                                }\n                            } \n                        \n                    })\n                    .catch(function(error) {\n                        console.log(\"Error getting document:\", error);\n                    });\n                   \n                }\n            })\n            .catch((err)=>{\n                console.log(err)\n            })\n                \n\n      },\n\n      signUp:(e)=>{\n            e.preventDefault();\n            if(pwdLogin === cnfPwdLogin){\n                if(user.email!==null){\n                    fire.auth().createUserWithEmailAndPassword(usrLogin,pwdLogin).then((res)=>{\n                    if(res){\n                        History.push('/products')\n                    }\n                    })\n                    .catch((err)=>{\n                        console.log(err)\n                    })\n                }\n                else\n                {\n                const cred = Firebase.auth.EmailAuthProvider.credential(usrLogin,pwdLogin)\n                Firebase.auth().currentUser.linkWithCredential(cred);\n                History.push('/products')\n                setUser({...user,email:usrLogin})\n                }\n            }\n            else{\n                alert(\"pwd not match\");\n            }\n        },\n\n        logout:() => {\n            fire.auth().signOut();\n            setCartItems([])\n        },\n        user:user,\n\n        saveAddress:(value,field) => {\n            setBillAddress({...billAddress,[field]:value})\n        },\n        submitAddress:(e) => {\n            e.preventDefault();\n            db.collection('billingAddress/').doc(user.userId).set({billAddress})\n        },\n       \n        billAddress:billAddress,\n        transcationSuccess:(data) => {\n             db.collection('Orders/').doc(user.userId).set({cartItems:cartItems,paymentDetails:data})\n             .then(function() {\n                 db.collection('User/').doc(user.userId).set({cartItems:[]})\n                 setCartItems([]);\n                History.push(\"/orderConfirmation\");\n            }).catch(function(error) {\n                console.log(\"Error writing document: \", error);\n            })\n        },\n        transcationError:() => {\n            console.log(\"transaction failed\");\n        },\n        transcationCancelled:() => {\n            console.log(\"transaction cancelled\")\n        },\n        onCheckout:(e) => {\n            History.push(\"/checkout\");\n        }\n\n\n  \n}\n\n}"]},"metadata":{},"sourceType":"module"}