{"ast":null,"code":"import { useState, useEffect, useReducer } from 'react';\nimport productReducer from '../reducer/productReducer';\nimport { FETCH_PRODUCTS, SEARCH_PRODUCTS, SORT_PRODUCTS, FETCH_CART_ITEMS } from '../actions/types';\nimport fire from '../config/fire';\nimport { Redirect } from 'react-router-dom';\nexport default (() => {\n  const [search, setSearch] = useState(\"\");\n  const [usrLogin, setUsr_Login] = useState(\"\");\n  const [pwdLogin, setPwd_Login] = useState(\"\");\n  const [cnfPwdLogin, setCnfPwd_Login] = useState(\"\");\n  const [user, setUser] = useState({});\n  const initialStateProducts = {\n    products: [],\n    filteredProducts: [],\n    search: \"\",\n    cartItems: []\n  };\n  const [state, dispatch] = useReducer(productReducer, initialStateProducts); //Products\n\n  useEffect(() => {\n    fetch(\"http://localhost:8000/products/\").then(res => res.json()).then(jsonResponse => {\n      dispatch({\n        type: FETCH_PRODUCTS,\n        payload: jsonResponse\n      });\n    });\n    return () => {};\n  }, []); //Local Storage\n\n  useEffect(() => {\n    if (localStorage.getItem(\"cartItems\")) {\n      dispatch({\n        type: FETCH_CART_ITEMS,\n        data: JSON.parse(localStorage.getItem(\"cartItems\"))\n      });\n    }\n\n    return () => {\n      localStorage.getItem(\"cartItems\");\n      console.log(\"clean up\");\n    };\n  }, []); //Search \n\n  useEffect(() => {\n    dispatch({\n      type: SEARCH_PRODUCTS,\n      data: search\n    });\n    return () => {\n      console.log(\"clean up\");\n    };\n  }, [search, state.products]);\n  useEffect(() => {\n    fire.auth().onAuthStateChanged(user => {\n      if (user) {\n        setUser({\n          user\n        });\n      } else {\n        setUser({\n          user: null\n        });\n      }\n    });\n    return () => {};\n  }, []);\n  return {\n    filteredProducts: state.filteredProducts,\n    cartItems: state.cartItems,\n    onAddCart: product => {\n      const cartItem = state.cartItems;\n      let productAlreadyInCart = false;\n      cartItem.forEach(item => {\n        if (item.id === product.id) {\n          productAlreadyInCart = true;\n          item.count++;\n        }\n      });\n\n      if (!productAlreadyInCart) {\n        cartItem.push({ ...product,\n          count: 1\n        });\n      }\n\n      dispatch({\n        type: FETCH_CART_ITEMS,\n        data: cartItem\n      });\n      localStorage.setItem(\"cartItems\", JSON.stringify(state.cartItems));\n    },\n    handleSearch: value => {\n      setSearch(value);\n    },\n    handleChangeSort: sort => {\n      dispatch({\n        type: SORT_PRODUCTS,\n        data: sort\n      });\n    },\n    onRemoveCart: removeItem => {\n      const update = [...state.cartItems].filter(item => {\n        if (item.id === removeItem.id && removeItem.count <= 1) return false;else {\n          if (item.id === removeItem.id && removeItem.count > 1) item.count--;\n          return true;\n        }\n      });\n      dispatch({\n        type: FETCH_CART_ITEMS,\n        data: update\n      });\n      localStorage.setItem(\"cartItems\", JSON.stringify(state.cartItems));\n    },\n    search: search,\n    userLoginChange: value => {\n      setUsr_Login(value);\n    },\n    pwdLoginChange: value => {\n      setPwd_Login(value);\n    },\n    cnfPwdLoginChange: value => {\n      setCnfPwd_Login(value);\n    },\n    login: e => {\n      e.preventDefault();\n      fire.auth().signInWithEmailAndPassword(usrLogin, pwdLogin).then(res => {\n        console.log(res);\n      }).catch(err => {\n        console.log(err);\n      });\n    },\n    signUp: e => {\n      e.preventDefault();\n\n      if (pwdLogin === cnfPwdLogin) {\n        fire.auth().createUserWithEmailAndPassword(usrLogin, pwdLogin).then(res => {\n          console.log(res);\n        }).catch(err => {\n          console.log(err);\n        });\n      } else {\n        alert(\"pwd didnt match\");\n      }\n    },\n    user: user\n  };\n});","map":{"version":3,"sources":["/Users/graj/projects/e-commerece/src/components/useProducts.js"],"names":["useState","useEffect","useReducer","productReducer","FETCH_PRODUCTS","SEARCH_PRODUCTS","SORT_PRODUCTS","FETCH_CART_ITEMS","fire","Redirect","search","setSearch","usrLogin","setUsr_Login","pwdLogin","setPwd_Login","cnfPwdLogin","setCnfPwd_Login","user","setUser","initialStateProducts","products","filteredProducts","cartItems","state","dispatch","fetch","then","res","json","jsonResponse","type","payload","localStorage","getItem","data","JSON","parse","console","log","auth","onAuthStateChanged","onAddCart","product","cartItem","productAlreadyInCart","forEach","item","id","count","push","setItem","stringify","handleSearch","value","handleChangeSort","sort","onRemoveCart","removeItem","update","filter","userLoginChange","pwdLoginChange","cnfPwdLoginChange","login","e","preventDefault","signInWithEmailAndPassword","catch","err","signUp","createUserWithEmailAndPassword","alert"],"mappings":"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","sourcesContent":["import {useState,useEffect,useReducer} from 'react';\nimport productReducer from '../reducer/productReducer';\nimport { FETCH_PRODUCTS, SEARCH_PRODUCTS, SORT_PRODUCTS, FETCH_CART_ITEMS} from '../actions/types';\nimport fire from '../config/fire';\nimport { Redirect } from 'react-router-dom'\n\n\nexport default () => {\n\n\n  const [search, setSearch] = useState(\"\");\n  const [usrLogin,setUsr_Login] = useState(\"\");\n  const [pwdLogin,setPwd_Login] = useState(\"\");\n  const [cnfPwdLogin,setCnfPwd_Login] = useState(\"\");\n  const [user,setUser] = useState({})\n\n\n  const initialStateProducts = {\n      products:[],\n      filteredProducts:[],\n      search:\"\",\n      cartItems:[]\n    }\n\n  const [state, dispatch] = useReducer(productReducer, initialStateProducts)\n\n    //Products\n    useEffect(() => {\n      fetch(\"http://localhost:8000/products/\")\n        .then(res => res.json())\n        .then(jsonResponse => { \n            dispatch({type:FETCH_PRODUCTS,payload:jsonResponse});\n        })\n     return () => {\n    \n        }\n    }, []);\n\n //Local Storage\n  useEffect(() => {\n    if(localStorage.getItem(\"cartItems\")){\n        dispatch({type:FETCH_CART_ITEMS,data:JSON.parse(localStorage.getItem(\"cartItems\"))})\n    }\n        return () => {\n          localStorage.getItem(\"cartItems\");\n          console.log(\"clean up\");\n        };\n    }, [])\n\n\n  //Search \n  useEffect(() => {\n    dispatch({type:SEARCH_PRODUCTS,data:search})\n    return () => {\n      console.log(\"clean up\");\n    };\n  }, [search,state.products])\n\n\n  useEffect(() => {\n    fire.auth().onAuthStateChanged((user)=>{\n        if(user)\n        {\n          setUser({user})\n        }\n        else{\n          setUser({user : null})\n        }\n      })\n      return () => {\n\n    }\n  }, [])\n\n\n\nreturn{\n    filteredProducts:state.filteredProducts,\n    cartItems:state.cartItems,\n    onAddCart : (product) => {\n        const cartItem = state.cartItems;\n        let productAlreadyInCart = false;\n        cartItem.forEach(item => {\n            if(item.id===product.id){\n                productAlreadyInCart  = true;\n                item.count++;\n            }\n        })\n          if(!productAlreadyInCart){\n            cartItem.push({...product,count:1})\n          }\n        dispatch({type:FETCH_CART_ITEMS,data:cartItem});\n        localStorage.setItem(\"cartItems\",JSON.stringify(state.cartItems));\n      },\n      handleSearch : (value) => {\n        setSearch(value);\n      },\n      handleChangeSort : (sort) => {\n         dispatch({type:SORT_PRODUCTS,data:sort})\n      },\n      onRemoveCart : (removeItem) => {\n       const update =  [...state.cartItems].filter(item => {\n            if(item.id===removeItem.id && removeItem.count<=1)\n              return false;\n            else{\n              if(item.id===removeItem.id && removeItem.count>1)\n                item.count--;\n              return true;\n            }\n        });\n        dispatch({type:FETCH_CART_ITEMS ,data:update})\n        localStorage.setItem(\"cartItems\",JSON.stringify(state.cartItems));\n      },\n      search:search,\n      userLoginChange:(value) => {\n          setUsr_Login(value);\n      },\n      pwdLoginChange:(value) =>{\n          setPwd_Login(value)\n      },\n      cnfPwdLoginChange:(value) => {\n          setCnfPwd_Login(value)\n      },\n      login:(e)=>{\n          e.preventDefault();\n          fire.auth().signInWithEmailAndPassword(usrLogin,pwdLogin).then((res)=>{\n            console.log(res);\n          })\n          .catch((err)=>{\n            console.log(err)\n          })\n      },\n      signUp:(e)=>{\n        e.preventDefault();\n        if(pwdLogin === cnfPwdLogin){\n        fire.auth().createUserWithEmailAndPassword(usrLogin,pwdLogin).then((res)=>{\n          console.log(res);\n        })\n        .catch((err)=>{\n          console.log(err)\n        })\n    }\n    else{\n        alert(\"pwd didnt match\")\n    }\n    },\n    user:user\n  \n}\n\n}"]},"metadata":{},"sourceType":"module"}