{"ast":null,"code":"import { useState, useEffect, useReducer } from 'react';\nimport productReducer from '../reducer/productReducer';\nimport { FETCH_PRODUCTS, SEARCH_PRODUCTS, SORT_PRODUCTS, FETCH_CART_ITEMS, ADD_TO_CART } from '../actions/types';\nexport default (() => {\n  const [search, setSearch] = useState(\"\");\n  const [cartItems, setCartItems] = useState([]);\n  const initialStateProducts = {\n    products: [],\n    filteredProducts: [],\n    search: \"\",\n    cartItems: []\n  };\n  const [state, dispatch] = useReducer(productReducer, initialStateProducts); //Products\n\n  useEffect(() => {\n    fetch(\"http://localhost:8000/products/\").then(res => res.json()).then(jsonResponse => {\n      dispatch({\n        type: FETCH_PRODUCTS,\n        payload: jsonResponse\n      });\n    });\n    return () => {};\n  }, []);\n  console.log(state, \"prod\"); //Local Storage\n\n  useEffect(() => {\n    if (localStorage.getItem(\"cartItems\")) {\n      dispatch({\n        type: FETCH_CART_ITEMS,\n        data: JSON.parse(localStorage.getItem(\"cartItems\"))\n      });\n    }\n\n    return () => {\n      localStorage.getItem(\"cartItems\");\n      console.log(\"clean up\");\n    };\n  }, []); //Search \n\n  useEffect(() => {\n    dispatch({\n      type: SEARCH_PRODUCTS,\n      data: search\n    });\n    return () => {\n      console.log(\"clean up\");\n    };\n  }, [search, state.products]);\n  return {\n    filteredProducts: state.filteredProducts,\n    cartItems: state.cartItems,\n    onAddCart: product => {\n      dispatch({\n        type: ADD_TO_CART,\n        data: product\n      });\n      localStorage.setItem(\"cartItems\", JSON.stringify(state.cartItems));\n    },\n    handleSearch: value => {\n      setSearch(value);\n    },\n    handleChangeSort: sort => {\n      dispatch({\n        type: SORT_PRODUCTS,\n        data: sort\n      });\n    },\n    onRemoveCart: removeItem => {\n      setCartItems([...cartItems].filter(item => {\n        if (item.id === removeItem.id && removeItem.count <= 1) return false;else {\n          if (item.id === removeItem.id && removeItem.count > 1) item.count--;\n          return true;\n        }\n      }));\n      localStorage.setItem(\"cartItems\", JSON.stringify(cartItems));\n    },\n    search\n  };\n});","map":{"version":3,"sources":["/Users/graj/projects/e-commerece/src/components/useProducts.js"],"names":["useState","useEffect","useReducer","productReducer","FETCH_PRODUCTS","SEARCH_PRODUCTS","SORT_PRODUCTS","FETCH_CART_ITEMS","ADD_TO_CART","search","setSearch","cartItems","setCartItems","initialStateProducts","products","filteredProducts","state","dispatch","fetch","then","res","json","jsonResponse","type","payload","console","log","localStorage","getItem","data","JSON","parse","onAddCart","product","setItem","stringify","handleSearch","value","handleChangeSort","sort","onRemoveCart","removeItem","filter","item","id","count"],"mappings":"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","sourcesContent":["import {useState,useEffect,useReducer} from 'react';\nimport productReducer from '../reducer/productReducer';\nimport { FETCH_PRODUCTS, SEARCH_PRODUCTS, SORT_PRODUCTS, FETCH_CART_ITEMS, ADD_TO_CART } from '../actions/types';\n\n\nexport default () => {\n\n\n  const [search, setSearch] = useState(\"\");\n  const [cartItems,setCartItems] = useState([]);\n\n  const initialStateProducts = {\n      products:[],\n      filteredProducts:[],\n      search:\"\",\n      cartItems:[]\n    }\n\n  const [state, dispatch] = useReducer(productReducer, initialStateProducts)\n\n//Products\n    useEffect(() => {\n      fetch(\"http://localhost:8000/products/\")\n        .then(res => res.json())\n        .then(jsonResponse => { \n            dispatch({type:FETCH_PRODUCTS,payload:jsonResponse});\n        })\n          return () => {\n           \n            }\n        }, []);\n\n        console.log(state,\"prod\")\n //Local Storage\n  useEffect(() => {\n    if(localStorage.getItem(\"cartItems\")){\n        dispatch({type:FETCH_CART_ITEMS,data:JSON.parse(localStorage.getItem(\"cartItems\"))})\n    }\n        return () => {\n          localStorage.getItem(\"cartItems\");\n          console.log(\"clean up\");\n        };\n    }, [])\n\n\n  //Search \n  useEffect(() => {\n    dispatch({type:SEARCH_PRODUCTS,data:search})\n\n    return () => {\n      console.log(\"clean up\");\n    };\n  }, [search,state.products])\n\n\n\nreturn{\n    filteredProducts:state.filteredProducts,\n    cartItems:state.cartItems,\n    onAddCart : (product) => {\n        dispatch({type:ADD_TO_CART,data:product})\n        localStorage.setItem(\"cartItems\",JSON.stringify(state.cartItems));\n      },\n      handleSearch : (value) => {\n        setSearch(value);\n      },\n      handleChangeSort : (sort) => {\n         dispatch({type:SORT_PRODUCTS,data:sort})\n      },\n      onRemoveCart : (removeItem) => {\n        setCartItems([...cartItems].filter(item => {\n            if(item.id===removeItem.id && removeItem.count<=1)\n              return false;\n            else{\n              if(item.id===removeItem.id && removeItem.count>1)\n                item.count--;\n              return true;\n            }\n        }));\n        localStorage.setItem(\"cartItems\",JSON.stringify(cartItems));\n      },\n      search\n  \n}\n\n}"]},"metadata":{},"sourceType":"module"}