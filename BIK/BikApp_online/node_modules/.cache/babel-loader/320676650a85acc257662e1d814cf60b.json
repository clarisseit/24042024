{"ast":null,"code":"import _regeneratorRuntime from\"/Users/graj/projects/Agricart-online-vegetable-shopping-reactjs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/graj/projects/Agricart-online-vegetable-shopping-reactjs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Users/graj/projects/Agricart-online-vegetable-shopping-reactjs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/graj/projects/Agricart-online-vegetable-shopping-reactjs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/graj/projects/Agricart-online-vegetable-shopping-reactjs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import fire from'../config/fire';import*as Firebase from'firebase/app';import History from'./History';export default(function(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),products=_useState2[0],setProducts=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),filteredProducts=_useState4[0],setfilteredProducts=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),cartItems=_useState6[0],setCartItems=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),search=_useState8[0],setSearch=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),usrLogin=_useState10[0],setUsr_Login=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),pwdLogin=_useState12[0],setPwd_Login=_useState12[1];var _useState13=useState(\"\"),_useState14=_slicedToArray(_useState13,2),cnfPwdLogin=_useState14[0],setCnfPwd_Login=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),guestCart=_useState16[0],setGuestCart=_useState16[1];var _useState17=useState({}),_useState18=_slicedToArray(_useState17,2),user=_useState18[0],setUser=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),orders=_useState20[0],setOrders=_useState20[1];var _useState21=useState('sandbox'),_useState22=_slicedToArray(_useState21,1),env=_useState22[0];var _useState23=useState('USD'),_useState24=_slicedToArray(_useState23,1),currency=_useState24[0];var _useState25=useState({sandbox:'ATKphVPUKrAFnWXr042hYQsynmg9U_UUeudlf1RjYkyKf3rsf5s3IE-H1QZWn8ziKEZzq5WH4TRalZR_',production:'YOUR-PRODUCTION-APP-ID'}),_useState26=_slicedToArray(_useState25,1),client=_useState26[0];var db=fire.firestore();//Products\nuseEffect(function(){db.collection('products').get().then(function(response){var data=response.docs.map(function(doc){var productData=doc.data();productData.id=doc.id;return productData;});setProducts(data);setfilteredProducts(data);});return function(){};},[db]);useEffect(function(){var unsubscribe=fire.auth().onAuthStateChanged(function(user){if(user){setUser({userId:user.uid,email:user.email});var userCartItem=db.collection(\"User\").doc(user.uid);var _orders=db.collection('Orders/').doc(user.uid);userCartItem.get().then(function(doc){if(doc.exists){setCartItems(doc.data().cartItems);}}).catch(function(error){console.log(\"Error getting document:\",error);});_orders.get().then(function(doc){if(doc.exists){setOrders(doc.data().cartItems);}}).catch(function(error){console.log(\"Error getting document:\",error);});}else{fire.auth().signInAnonymously();}});return function(){unsubscribe();};},[db]);//Search \nuseEffect(function(){setfilteredProducts(_toConsumableArray(products).filter(function(product){return product.title.toLowerCase().includes(search.toLowerCase());}));return function(){};},[search,products]);useEffect(function(){if(user.email===null)setGuestCart(cartItems);return function(){};},[cartItems,user.email]);var resultFilter=function resultFilter(temp1,temp2){return temp1.filter(function(temp1){return!temp2.some(function(temp2){return temp1.id===temp2.id;});});};return{filteredProducts:filteredProducts,cartItems:cartItems,search:search,orders:orders,env:env,currency:currency,client:client,onAddCart:function(){var _onAddCart=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(product){var cartItem,productAlreadyInCart;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:cartItem=cartItems;productAlreadyInCart=false;cartItem.forEach(function(item){if(item.id===product.id){productAlreadyInCart=true;item.count++;}});if(!productAlreadyInCart){cartItem.push(_objectSpread(_objectSpread({},product),{},{count:1}));}setCartItems(_toConsumableArray(cartItem));if(!(user.userId!==null)){_context.next=8;break;}_context.next=8;return db.collection('User/').doc(user.userId).set({cartItems:cartItem});case 8:case\"end\":return _context.stop();}}},_callee);}));function onAddCart(_x){return _onAddCart.apply(this,arguments);}return onAddCart;}(),handleSearch:function handleSearch(value){setSearch(value);},handleChangeSort:function handleChangeSort(sort){if(sort!==''){var updated=_toConsumableArray(products).sort(function(a,b){return sort===\"lowest\"?a.price>b.price?1:-1:a.price<b.price?1:-1;});setfilteredProducts(updated);}else{var _updated=_toConsumableArray(products).sort(function(a,b){return a.id<b.id?1:-1;});setfilteredProducts(_updated);}},onRemoveCart:function(){var _onRemoveCart=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(removeItem){var update;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:update=_toConsumableArray(cartItems).filter(function(item){if(item.id===removeItem.id&&removeItem.count<=1)return false;else{if(item.id===removeItem.id&&removeItem.count>1)item.count--;return true;}});setCartItems(update);if(!(user.userId!==null)){_context2.next=5;break;}_context2.next=5;return db.collection('User/').doc(user.userId).update({cartItems:update});case 5:case\"end\":return _context2.stop();}}},_callee2);}));function onRemoveCart(_x2){return _onRemoveCart.apply(this,arguments);}return onRemoveCart;}(),userLoginChange:function userLoginChange(value){setUsr_Login(value);},pwdLoginChange:function pwdLoginChange(value){setPwd_Login(value);},cnfPwdLoginChange:function cnfPwdLoginChange(value){setCnfPwd_Login(value);},buy:function buy(value){History.push('/Agricart-online-vegetable-shopping-reactjs/'+value);},login:function login(e){e.preventDefault();fire.auth().signInWithEmailAndPassword(usrLogin,pwdLogin).then(function(res){if(res){var userCartItem=db.collection(\"User\").doc(res.user.uid);userCartItem.get().then(function(doc){if(doc.exists){var upc=doc.data().cartItems;if(user.email===null){var update=[];upc.forEach(function(cartItem){guestCart.forEach(function(guestCar){if(cartItem.title===guestCar.title){guestCar.count=cartItem.count+guestCar.count;update.push(guestCar);}});});resultFilter(upc,guestCart).forEach(function(val){update.push(val);});resultFilter(guestCart,upc).forEach(function(val){update.push(val);});db.collection('User/').doc(res.user.uid).set({cartItems:update});History.push('/Agricart-online-vegetable-shopping-reactjs');}}}).catch(function(error){console.log(\"Error getting document:\",error);});}}).catch(function(err){console.log(err);});},signUp:function signUp(e){e.preventDefault();if(pwdLogin===cnfPwdLogin){if(user.email!==null){fire.auth().createUserWithEmailAndPassword(usrLogin,pwdLogin).then(function(res){if(res){History.push('/Agricart-online-vegetable-shopping-reactjs/products');}}).catch(function(err){console.log(err);});}else{var cred=Firebase.auth.EmailAuthProvider.credential(usrLogin,pwdLogin);Firebase.auth().currentUser.linkWithCredential(cred);History.push('/Agricart-online-vegetable-shopping-reactjs/products');setUser(_objectSpread(_objectSpread({},user),{},{email:usrLogin}));}}else{alert(\"pwd not match\");}},logout:function logout(){fire.auth().signOut();setCartItems([]);},user:user,transcationSuccess:function transcationSuccess(data){db.collection('Orders/').doc(user.userId).set({cartItems:cartItems,paymentDetails:data}).then(function(){db.collection('User/').doc(user.userId).set({cartItems:[]});setCartItems([]);History.push(\"/Agricart-online-vegetable-shopping-reactjs/orderConfirmation\");}).catch(function(error){console.log(\"Error writing document: \",error);});},transcationError:function transcationError(){console.log(\"transaction failed\");},transcationCancelled:function transcationCancelled(){console.log(\"transaction cancelled\");},onCheckout:function onCheckout(e){History.push(\"/Agricart-online-vegetable-shopping-reactjs/checkout\");}};});","map":{"version":3,"sources":["/Users/graj/projects/Agricart-online-vegetable-shopping-reactjs/src/components/useProducts.js"],"names":["useState","useEffect","fire","Firebase","History","products","setProducts","filteredProducts","setfilteredProducts","cartItems","setCartItems","search","setSearch","usrLogin","setUsr_Login","pwdLogin","setPwd_Login","cnfPwdLogin","setCnfPwd_Login","guestCart","setGuestCart","user","setUser","orders","setOrders","env","currency","sandbox","production","client","db","firestore","collection","get","then","response","data","docs","map","doc","productData","id","unsubscribe","auth","onAuthStateChanged","userId","uid","email","userCartItem","exists","catch","error","console","log","signInAnonymously","filter","product","title","toLowerCase","includes","resultFilter","temp1","temp2","some","onAddCart","cartItem","productAlreadyInCart","forEach","item","count","push","set","handleSearch","value","handleChangeSort","sort","updated","a","b","price","onRemoveCart","removeItem","update","userLoginChange","pwdLoginChange","cnfPwdLoginChange","buy","login","e","preventDefault","signInWithEmailAndPassword","res","upc","guestCar","val","err","signUp","createUserWithEmailAndPassword","cred","EmailAuthProvider","credential","currentUser","linkWithCredential","alert","logout","signOut","transcationSuccess","paymentDetails","transcationError","transcationCancelled","onCheckout"],"mappings":"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","sourcesContent":["import {useState,useEffect} from 'react';\nimport fire from '../config/fire';\nimport * as Firebase from 'firebase/app';\nimport History from './History';\n\n\n\nexport default () => {\n\n  const [products,setProducts] = useState([])\n  const [filteredProducts,setfilteredProducts] = useState([])\n  const [cartItems,setCartItems] = useState([])\n  const [search, setSearch] = useState(\"\");\n  const [usrLogin,setUsr_Login] = useState(\"\");\n  const [pwdLogin,setPwd_Login] = useState(\"\");\n  const [cnfPwdLogin,setCnfPwd_Login] = useState(\"\");\n  const [guestCart,setGuestCart] = useState([]);\n  const [user,setUser] = useState({});\n  const [orders,setOrders] = useState([]);\n  const [env] = useState('sandbox');\n  const [currency] = useState('USD');\n  const [client] = useState({\n        sandbox:    'ATKphVPUKrAFnWXr042hYQsynmg9U_UUeudlf1RjYkyKf3rsf5s3IE-H1QZWn8ziKEZzq5WH4TRalZR_',\n        production: 'YOUR-PRODUCTION-APP-ID',\n    })\n    \n\n\n  const db = fire.firestore();\n\n\n    //Products\n    useEffect(() => {\n        db.collection('products')\n        .get()\n        .then(response => {\n            const data = response.docs.map(doc => {\n                const productData = doc.data();\n                productData.id=doc.id;\n                return productData\n            });\n                setProducts(data)\n                setfilteredProducts(data)\n            })\n         return () => {\n    \n        }\n    }, [db]);\n\n\n    useEffect(() => {\n\n       const unsubscribe = fire.auth().onAuthStateChanged((user)=>{\n         if(user)\n            {\n            setUser({userId:user.uid,email:user.email})\n\n            let userCartItem = db.collection(\"User\").doc(user.uid);\n            let orders = db.collection('Orders/').doc(user.uid);\n\n            userCartItem.get().then(function(doc) {\n                if (doc.exists) {\n                        setCartItems(doc.data().cartItems);\n                } \n            }).catch(function(error) {\n                console.log(\"Error getting document:\", error);\n            });\n\n            orders.get().then(function(doc) {\n                if (doc.exists) {\n                        setOrders(doc.data().cartItems);\n                } \n            }).catch(function(error) {\n                console.log(\"Error getting document:\", error);\n            });\n\n            }\n            else{\n             fire.auth().signInAnonymously()\n                 \n            }\n       \n          })\n          return () => { \n              unsubscribe();\n          }\n      }, [db])\n\n\n        //Search \n        useEffect(() => {\n            setfilteredProducts(\n                    [...products].filter(product => {\n                        return product.title.toLowerCase().includes(search.toLowerCase());\n                    })\n            )\n            return () => {\n\n            };\n        }, [search,products])\n\n  \n     useEffect(() => {\n        \n         if(user.email===null)\n            setGuestCart(cartItems)\n         return () => {\n       \n         }\n     }, [cartItems,user.email])\n\n\n     let resultFilter = (temp1, temp2) => {\n        return temp1.filter(temp1 =>\n          !temp2.some(\n            temp2 => temp1.id === temp2.id\n          )\n        );\n      };\n\n      \nreturn{\n    filteredProducts:filteredProducts,\n    cartItems:cartItems,\n    search:search,\n    orders:orders,\n    env:env,\n    currency:currency,\n    client:client,\n\n    onAddCart : async(product) => {\n            const cartItem = cartItems;\n            let productAlreadyInCart = false;\n            cartItem.forEach(item => {\n                if(item.id===product.id){\n                    productAlreadyInCart  = true;\n                    item.count++;\n                }\n            })\n            if(!productAlreadyInCart){\n                cartItem.push({...product,count:1})\n            }\n            setCartItems([...cartItem])\n            if(user.userId!==null)\n                await db.collection('User/').doc(user.userId).set({cartItems:cartItem});\n    },\n      handleSearch : (value) => {\n        setSearch(value);\n      },\n\n      handleChangeSort : (sort) => {\n        if(sort!==''){\n            const updated =  [...products].sort((a,b) => {\n              return (sort===\"lowest\")?(a.price > b.price?1:-1):(a.price < b.price?1:-1);\n            });\n            setfilteredProducts(updated);\n        }\n        else{\n          const updated = [...products].sort((a,b)=> { return (a.id < b.id ?1:-1)});\n          setfilteredProducts(updated);\n        }\n      },\n\n      onRemoveCart : async (removeItem) => {\n            const update =  [...cartItems].filter(item => {\n                    if(item.id===removeItem.id && removeItem.count<=1)\n                    return false;\n                    else{\n                    if(item.id===removeItem.id && removeItem.count>1)\n                        item.count--;\n                    return true;\n                    }\n                });\n                setCartItems(update);\n                if(user.userId!==null)\n                    await db.collection('User/').doc(user.userId).update({cartItems:update});\n      },\n\n      userLoginChange:(value) => {\n          setUsr_Login(value);\n      },\n\n      pwdLoginChange:(value) =>{\n          setPwd_Login(value)\n      },\n\n      cnfPwdLoginChange:(value) => {\n          setCnfPwd_Login(value)\n      },\n      buy:(value) => {\n          History.push('/Agricart-online-vegetable-shopping-reactjs/'+value);\n      },\n\n      login: (e)=>{\n          e.preventDefault();\n            fire.auth().signInWithEmailAndPassword(usrLogin,pwdLogin).then((res)=>{\n                if(res){\n                    let userCartItem = db.collection(\"User\").doc(res.user.uid);\n                    userCartItem.get().then(function(doc) {\n                        if (doc.exists) {\n                            \n                            let upc = doc.data().cartItems;\n                            \n                        if(user.email===null){\n                            let update = []\n                            upc.forEach(function(cartItem){\n                                guestCart.forEach(function(guestCar){\n                                    if(cartItem.title===guestCar.title){\n                                                 guestCar.count = cartItem.count + guestCar.count;\n                                                 update.push(guestCar);\n                                         }\n                                            })\n                                        })\n                                        resultFilter(upc,guestCart).forEach(function(val){\n                                            update.push(val)\n                                        })\n                                        resultFilter(guestCart,upc).forEach(function(val){\n                                            update.push(val)\n                                        })\n                            db.collection('User/').doc(res.user.uid).set({cartItems:update});\n                            History.push('/Agricart-online-vegetable-shopping-reactjs');\n                                }\n                            } \n                        \n                    })\n                    .catch(function(error) {\n                        console.log(\"Error getting document:\", error);\n                    });\n                   \n                }\n            })\n            .catch((err)=>{\n                console.log(err)\n            })\n                \n\n      },\n\n      signUp:(e)=>{\n            e.preventDefault();\n            if(pwdLogin === cnfPwdLogin){\n                if(user.email!==null){\n                    fire.auth().createUserWithEmailAndPassword(usrLogin,pwdLogin).then((res)=>{\n                    if(res){\n                        History.push('/Agricart-online-vegetable-shopping-reactjs/products')\n                    }\n                    })\n                    .catch((err)=>{\n                        console.log(err)\n                    })\n                }\n                else\n                {\n                const cred = Firebase.auth.EmailAuthProvider.credential(usrLogin,pwdLogin)\n                Firebase.auth().currentUser.linkWithCredential(cred);\n                History.push('/Agricart-online-vegetable-shopping-reactjs/products')\n                setUser({...user,email:usrLogin})\n                }\n            }\n            else{\n                alert(\"pwd not match\");\n            }\n        },\n\n        logout:() => {\n            fire.auth().signOut();\n            setCartItems([])\n        },\n        user:user,\n        transcationSuccess:(data) => {\n             db.collection('Orders/').doc(user.userId).set({cartItems:cartItems,paymentDetails:data})\n             .then(function() {\n                 db.collection('User/').doc(user.userId).set({cartItems:[]})\n                 setCartItems([]);\n                History.push(\"/Agricart-online-vegetable-shopping-reactjs/orderConfirmation\");\n            }).catch(function(error) {\n                console.log(\"Error writing document: \", error);\n            })\n        },\n        transcationError:() => {\n            console.log(\"transaction failed\");\n        },\n        transcationCancelled:() => {\n            console.log(\"transaction cancelled\")\n        },\n        onCheckout:(e) => {\n            History.push(\"/Agricart-online-vegetable-shopping-reactjs/checkout\");\n        }\n\n\n  \n}\n\n}"]},"metadata":{},"sourceType":"module"}