{"ast":null,"code":"import { useState, useEffect } from 'react';\nimport fire from '../config/fire';\nimport History from './History';\nexport default (() => {\n  const [products, setProducts] = useState([]);\n  const [filteredProducts, setfilteredProducts] = useState([]);\n  const [cartItems, setCartItems] = useState([]);\n  const [search, setSearch] = useState(\"\");\n  const [usrLogin, setUsr_Login] = useState(\"\");\n  const [pwdLogin, setPwd_Login] = useState(\"\");\n  const [cnfPwdLogin, setCnfPwd_Login] = useState(\"\");\n  const [user, setUser] = useState({}); //Products\n\n  useEffect(() => {\n    fetch(\"http://localhost:8000/products/\").then(res => res.json()).then(jsonResponse => {\n      setProducts(jsonResponse);\n      setfilteredProducts(jsonResponse);\n    });\n    return () => {};\n  }, []); //Local Storage\n\n  useEffect(() => {\n    if (localStorage.getItem(\"cartItems\")) {\n      setCartItems(JSON.parse(localStorage.getItem(\"cartItems\")));\n    }\n\n    return () => {\n      localStorage.getItem(\"cartItems\");\n    };\n  }, []); //Search \n\n  useEffect(() => {\n    setfilteredProducts([...products].filter(product => {\n      return product.title.toLowerCase().includes(search.toLowerCase());\n    }));\n    return () => {\n      console.log(\"clean up\");\n    };\n  }, [search, products]);\n  return {\n    filteredProducts: filteredProducts,\n    cartItems: cartItems,\n    search: search,\n    onAddCart: product => {\n      const cartItem = cartItems;\n      let productAlreadyInCart = false;\n      cartItem.forEach(item => {\n        if (item.id === product.id) {\n          productAlreadyInCart = true;\n          item.count++;\n        }\n      });\n\n      if (!productAlreadyInCart) {\n        cartItem.push({ ...product,\n          count: 1\n        });\n      }\n\n      setCartItems([...cartItem]);\n      localStorage.setItem(\"cartItems\", JSON.stringify(cartItems));\n    },\n    handleSearch: value => {\n      setSearch(value);\n    },\n    handleChangeSort: sort => {\n      if (sort !== '') {\n        const updated = [...products].sort((a, b) => {\n          return sort === \"lowest\" ? a.price > b.price ? 1 : -1 : a.price < b.price ? 1 : -1;\n        });\n        setfilteredProducts(updated);\n      } else {\n        const updated = [...products].sort((a, b) => {\n          return a.id < b.id ? 1 : -1;\n        });\n        setfilteredProducts(updated);\n      }\n    },\n    onRemoveCart: removeItem => {\n      const update = [...cartItems].filter(item => {\n        if (item.id === removeItem.id && removeItem.count <= 1) return false;else {\n          if (item.id === removeItem.id && removeItem.count > 1) item.count--;\n          return true;\n        }\n      });\n      setCartItems(update);\n      localStorage.setItem(\"cartItems\", JSON.stringify(cartItems));\n    },\n    userLoginChange: value => {\n      setUsr_Login(value);\n    },\n    pwdLoginChange: value => {\n      setPwd_Login(value);\n    },\n    cnfPwdLoginChange: value => {\n      setCnfPwd_Login(value);\n    },\n    login: e => {\n      e.preventDefault();\n      fire.auth().signInWithEmailAndPassword(usrLogin, pwdLogin).then(res => {\n        if (res) {\n          setUser({ ...user,\n            login: true\n          });\n          History.push('/products');\n        }\n      }).catch(err => {\n        setUser({ ...user,\n          login: false\n        });\n        console.log(err);\n      });\n    },\n    signUp: e => {\n      e.preventDefault();\n\n      if (pwdLogin === cnfPwdLogin) {\n        fire.auth().createUserWithEmailAndPassword(usrLogin, pwdLogin).then(res => {\n          if (res) {\n            setUser({ ...user,\n              login: true\n            });\n            History.push('/products');\n          }\n        }).catch(err => {\n          setUser({ ...user,\n            login: false\n          });\n          console.log(err);\n        });\n      } else {\n        alert(\"pwd didnt match\");\n      }\n    }\n  };\n});","map":{"version":3,"sources":["/Users/graj/projects/e-commerece/src/components/useProducts.js"],"names":["useState","useEffect","fire","History","products","setProducts","filteredProducts","setfilteredProducts","cartItems","setCartItems","search","setSearch","usrLogin","setUsr_Login","pwdLogin","setPwd_Login","cnfPwdLogin","setCnfPwd_Login","user","setUser","fetch","then","res","json","jsonResponse","localStorage","getItem","JSON","parse","filter","product","title","toLowerCase","includes","console","log","onAddCart","cartItem","productAlreadyInCart","forEach","item","id","count","push","setItem","stringify","handleSearch","value","handleChangeSort","sort","updated","a","b","price","onRemoveCart","removeItem","update","userLoginChange","pwdLoginChange","cnfPwdLoginChange","login","e","preventDefault","auth","signInWithEmailAndPassword","catch","err","signUp","createUserWithEmailAndPassword","alert"],"mappings":"AAAA,SAAQA,QAAR,EAAiBC,SAAjB,QAAiC,OAAjC;AACA,OAAOC,IAAP,MAAiB,gBAAjB;AACA,OAAOC,OAAP,MAAoB,WAApB;AAIA,gBAAe,MAAM;AAEnB,QAAM,CAACC,QAAD,EAAUC,WAAV,IAAyBL,QAAQ,CAAC,EAAD,CAAvC;AACA,QAAM,CAACM,gBAAD,EAAkBC,mBAAlB,IAAyCP,QAAQ,CAAC,EAAD,CAAvD;AACA,QAAM,CAACQ,SAAD,EAAWC,YAAX,IAA2BT,QAAQ,CAAC,EAAD,CAAzC;AACA,QAAM,CAACU,MAAD,EAASC,SAAT,IAAsBX,QAAQ,CAAC,EAAD,CAApC;AACA,QAAM,CAACY,QAAD,EAAUC,YAAV,IAA0Bb,QAAQ,CAAC,EAAD,CAAxC;AACA,QAAM,CAACc,QAAD,EAAUC,YAAV,IAA0Bf,QAAQ,CAAC,EAAD,CAAxC;AACA,QAAM,CAACgB,WAAD,EAAaC,eAAb,IAAgCjB,QAAQ,CAAC,EAAD,CAA9C;AACA,QAAM,CAACkB,IAAD,EAAMC,OAAN,IAAiBnB,QAAQ,CAAC,EAAD,CAA/B,CATmB,CAYjB;;AACAC,EAAAA,SAAS,CAAC,MAAM;AACdmB,IAAAA,KAAK,CAAC,iCAAD,CAAL,CACGC,IADH,CACQC,GAAG,IAAIA,GAAG,CAACC,IAAJ,EADf,EAEMF,IAFN,CAEWG,YAAY,IAAI;AACjBnB,MAAAA,WAAW,CAACmB,YAAD,CAAX;AACAjB,MAAAA,mBAAmB,CAACiB,YAAD,CAAnB;AACH,KALP;AAMG,WAAO,MAAM,CAEb,CAFA;AAGJ,GAVQ,EAUN,EAVM,CAAT,CAbiB,CAyBpB;;AACCvB,EAAAA,SAAS,CAAC,MAAM;AACV,QAAGwB,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAH,EAAqC;AACjCjB,MAAAA,YAAY,CAACkB,IAAI,CAACC,KAAL,CAAWH,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAX,CAAD,CAAZ;AACH;;AACD,WAAO,MAAM;AACXD,MAAAA,YAAY,CAACC,OAAb,CAAqB,WAArB;AACD,KAFD;AAGH,GAPM,EAOJ,EAPI,CAAT,CA1BmB,CAoCnB;;AACAzB,EAAAA,SAAS,CAAC,MAAM;AACZM,IAAAA,mBAAmB,CACb,CAAC,GAAGH,QAAJ,EAAcyB,MAAd,CAAqBC,OAAO,IAAI;AAC5B,aAAOA,OAAO,CAACC,KAAR,CAAcC,WAAd,GAA4BC,QAA5B,CAAqCvB,MAAM,CAACsB,WAAP,EAArC,CAAP;AACH,KAFD,CADa,CAAnB;AAKF,WAAO,MAAM;AACXE,MAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AACD,KAFD;AAGD,GATQ,EASN,CAACzB,MAAD,EAAQN,QAAR,CATM,CAAT;AAgBF,SAAM;AACFE,IAAAA,gBAAgB,EAACA,gBADf;AAEFE,IAAAA,SAAS,EAACA,SAFR;AAGFE,IAAAA,MAAM,EAACA,MAHL;AAMF0B,IAAAA,SAAS,EAAIN,OAAD,IAAa;AACrB,YAAMO,QAAQ,GAAG7B,SAAjB;AACA,UAAI8B,oBAAoB,GAAG,KAA3B;AACAD,MAAAA,QAAQ,CAACE,OAAT,CAAiBC,IAAI,IAAI;AACrB,YAAGA,IAAI,CAACC,EAAL,KAAUX,OAAO,CAACW,EAArB,EAAwB;AACpBH,UAAAA,oBAAoB,GAAI,IAAxB;AACAE,UAAAA,IAAI,CAACE,KAAL;AACH;AACJ,OALD;;AAME,UAAG,CAACJ,oBAAJ,EAAyB;AACvBD,QAAAA,QAAQ,CAACM,IAAT,CAAc,EAAC,GAAGb,OAAJ;AAAYY,UAAAA,KAAK,EAAC;AAAlB,SAAd;AACD;;AACHjC,MAAAA,YAAY,CAAC,CAAC,GAAG4B,QAAJ,CAAD,CAAZ;AACAZ,MAAAA,YAAY,CAACmB,OAAb,CAAqB,WAArB,EAAiCjB,IAAI,CAACkB,SAAL,CAAerC,SAAf,CAAjC;AACD,KApBD;AAqBAsC,IAAAA,YAAY,EAAIC,KAAD,IAAW;AACxBpC,MAAAA,SAAS,CAACoC,KAAD,CAAT;AACD,KAvBD;AAyBAC,IAAAA,gBAAgB,EAAIC,IAAD,IAAU;AAC3B,UAAGA,IAAI,KAAG,EAAV,EAAa;AACT,cAAMC,OAAO,GAAI,CAAC,GAAG9C,QAAJ,EAAc6C,IAAd,CAAmB,CAACE,CAAD,EAAGC,CAAH,KAAS;AAC3C,iBAAQH,IAAI,KAAG,QAAR,GAAmBE,CAAC,CAACE,KAAF,GAAUD,CAAC,CAACC,KAAZ,GAAkB,CAAlB,GAAoB,CAAC,CAAxC,GAA4CF,CAAC,CAACE,KAAF,GAAUD,CAAC,CAACC,KAAZ,GAAkB,CAAlB,GAAoB,CAAC,CAAxE;AACD,SAFgB,CAAjB;AAGA9C,QAAAA,mBAAmB,CAAC2C,OAAD,CAAnB;AACH,OALD,MAMI;AACF,cAAMA,OAAO,GAAG,CAAC,GAAG9C,QAAJ,EAAc6C,IAAd,CAAmB,CAACE,CAAD,EAAGC,CAAH,KAAQ;AAAE,iBAAQD,CAAC,CAACV,EAAF,GAAOW,CAAC,CAACX,EAAT,GAAa,CAAb,GAAe,CAAC,CAAxB;AAA2B,SAAxD,CAAhB;AACAlC,QAAAA,mBAAmB,CAAC2C,OAAD,CAAnB;AACD;AACF,KApCD;AAsCAI,IAAAA,YAAY,EAAIC,UAAD,IAAgB;AAC9B,YAAMC,MAAM,GAAI,CAAC,GAAGhD,SAAJ,EAAeqB,MAAf,CAAsBW,IAAI,IAAI;AACzC,YAAGA,IAAI,CAACC,EAAL,KAAUc,UAAU,CAACd,EAArB,IAA2Bc,UAAU,CAACb,KAAX,IAAkB,CAAhD,EACE,OAAO,KAAP,CADF,KAEI;AACF,cAAGF,IAAI,CAACC,EAAL,KAAUc,UAAU,CAACd,EAArB,IAA2Bc,UAAU,CAACb,KAAX,GAAiB,CAA/C,EACEF,IAAI,CAACE,KAAL;AACF,iBAAO,IAAP;AACD;AACJ,OARc,CAAhB;AASCjC,MAAAA,YAAY,CAAC+C,MAAD,CAAZ;AACA/B,MAAAA,YAAY,CAACmB,OAAb,CAAqB,WAArB,EAAiCjB,IAAI,CAACkB,SAAL,CAAerC,SAAf,CAAjC;AACD,KAlDD;AAoDAiD,IAAAA,eAAe,EAAEV,KAAD,IAAW;AACvBlC,MAAAA,YAAY,CAACkC,KAAD,CAAZ;AACH,KAtDD;AAwDAW,IAAAA,cAAc,EAAEX,KAAD,IAAU;AACrBhC,MAAAA,YAAY,CAACgC,KAAD,CAAZ;AACH,KA1DD;AA4DAY,IAAAA,iBAAiB,EAAEZ,KAAD,IAAW;AACzB9B,MAAAA,eAAe,CAAC8B,KAAD,CAAf;AACH,KA9DD;AAgEAa,IAAAA,KAAK,EAAEC,CAAD,IAAK;AACPA,MAAAA,CAAC,CAACC,cAAF;AACA5D,MAAAA,IAAI,CAAC6D,IAAL,GAAYC,0BAAZ,CAAuCpD,QAAvC,EAAgDE,QAAhD,EAA0DO,IAA1D,CAAgEC,GAAD,IAAO;AAClE,YAAGA,GAAH,EAAO;AACHH,UAAAA,OAAO,CAAC,EAAC,GAAGD,IAAJ;AAAS0C,YAAAA,KAAK,EAAC;AAAf,WAAD,CAAP;AACAzD,UAAAA,OAAO,CAACwC,IAAR,CAAa,WAAb;AACH;AACJ,OALD,EAMCsB,KAND,CAMQC,GAAD,IAAO;AACZ/C,QAAAA,OAAO,CAAC,EAAC,GAAGD,IAAJ;AAAS0C,UAAAA,KAAK,EAAC;AAAf,SAAD,CAAP;AAEA1B,QAAAA,OAAO,CAACC,GAAR,CAAY+B,GAAZ;AACD,OAVD;AAWH,KA7ED;AA+EAC,IAAAA,MAAM,EAAEN,CAAD,IAAK;AACNA,MAAAA,CAAC,CAACC,cAAF;;AACA,UAAGhD,QAAQ,KAAKE,WAAhB,EAA4B;AACxBd,QAAAA,IAAI,CAAC6D,IAAL,GAAYK,8BAAZ,CAA2CxD,QAA3C,EAAoDE,QAApD,EAA8DO,IAA9D,CAAoEC,GAAD,IAAO;AAC1E,cAAGA,GAAH,EAAO;AACHH,YAAAA,OAAO,CAAC,EAAC,GAAGD,IAAJ;AAAS0C,cAAAA,KAAK,EAAC;AAAf,aAAD,CAAP;AACAzD,YAAAA,OAAO,CAACwC,IAAR,CAAa,WAAb;AACH;AACA,SALD,EAMCsB,KAND,CAMQC,GAAD,IAAO;AACV/C,UAAAA,OAAO,CAAC,EAAC,GAAGD,IAAJ;AAAS0C,YAAAA,KAAK,EAAC;AAAf,WAAD,CAAP;AACA1B,UAAAA,OAAO,CAACC,GAAR,CAAY+B,GAAZ;AACH,SATD;AAUH,OAXD,MAYI;AACAG,QAAAA,KAAK,CAAC,iBAAD,CAAL;AACH;AACJ;AAhGH,GAAN;AAoGC,CAzJD","sourcesContent":["import {useState,useEffect} from 'react';\nimport fire from '../config/fire';\nimport History from './History';\n\n\n\nexport default () => {\n\n  const [products,setProducts] = useState([])\n  const [filteredProducts,setfilteredProducts] = useState([])\n  const [cartItems,setCartItems] = useState([])\n  const [search, setSearch] = useState(\"\");\n  const [usrLogin,setUsr_Login] = useState(\"\");\n  const [pwdLogin,setPwd_Login] = useState(\"\");\n  const [cnfPwdLogin,setCnfPwd_Login] = useState(\"\");\n  const [user,setUser] = useState({});\n\n\n    //Products\n    useEffect(() => {\n      fetch(\"http://localhost:8000/products/\")\n        .then(res => res.json())\n           .then(jsonResponse => { \n                setProducts(jsonResponse)\n                setfilteredProducts(jsonResponse)\n            })\n         return () => {\n    \n        }\n    }, []);\n\n //Local Storage\n  useEffect(() => {\n        if(localStorage.getItem(\"cartItems\")){\n            setCartItems(JSON.parse(localStorage.getItem(\"cartItems\")))\n        }\n        return () => {\n          localStorage.getItem(\"cartItems\");\n        };\n    }, [])\n\n\n  //Search \n  useEffect(() => {\n      setfilteredProducts(\n            [...products].filter(product => {\n                return product.title.toLowerCase().includes(search.toLowerCase());\n            })\n      )\n    return () => {\n      console.log(\"clean up\");\n    };\n  }, [search,products])\n\n\n  \n\n\n\nreturn{\n    filteredProducts:filteredProducts,\n    cartItems:cartItems,\n    search:search,\n\n\n    onAddCart : (product) => {\n        const cartItem = cartItems;\n        let productAlreadyInCart = false;\n        cartItem.forEach(item => {\n            if(item.id===product.id){\n                productAlreadyInCart  = true;\n                item.count++;\n            }\n        })\n          if(!productAlreadyInCart){\n            cartItem.push({...product,count:1})\n          }\n        setCartItems([...cartItem])\n        localStorage.setItem(\"cartItems\",JSON.stringify(cartItems));\n      },\n      handleSearch : (value) => {\n        setSearch(value);\n      },\n\n      handleChangeSort : (sort) => {\n        if(sort!==''){\n            const updated =  [...products].sort((a,b) => {\n              return (sort===\"lowest\")?(a.price > b.price?1:-1):(a.price < b.price?1:-1);\n            });\n            setfilteredProducts(updated);\n        }\n        else{\n          const updated = [...products].sort((a,b)=> { return (a.id < b.id ?1:-1)});\n          setfilteredProducts(updated);\n        }\n      },\n\n      onRemoveCart : (removeItem) => {\n       const update =  [...cartItems].filter(item => {\n            if(item.id===removeItem.id && removeItem.count<=1)\n              return false;\n            else{\n              if(item.id===removeItem.id && removeItem.count>1)\n                item.count--;\n              return true;\n            }\n        });\n        setCartItems(update);\n        localStorage.setItem(\"cartItems\",JSON.stringify(cartItems));\n      },\n\n      userLoginChange:(value) => {\n          setUsr_Login(value);\n      },\n\n      pwdLoginChange:(value) =>{\n          setPwd_Login(value)\n      },\n\n      cnfPwdLoginChange:(value) => {\n          setCnfPwd_Login(value)\n      },\n\n      login:(e)=>{\n          e.preventDefault();\n          fire.auth().signInWithEmailAndPassword(usrLogin,pwdLogin).then((res)=>{\n              if(res){\n                  setUser({...user,login:true});\n                  History.push('/products');\n              }\n          })\n          .catch((err)=>{\n            setUser({...user,login:false});\n              \n            console.log(err)\n          })\n      },\n\n      signUp:(e)=>{\n            e.preventDefault();\n            if(pwdLogin === cnfPwdLogin){\n                fire.auth().createUserWithEmailAndPassword(usrLogin,pwdLogin).then((res)=>{\n                if(res){\n                    setUser({...user,login:true});\n                    History.push('/products')\n                }\n                })\n                .catch((err)=>{\n                    setUser({...user,login:false});\n                    console.log(err)\n                })\n            }\n            else{\n                alert(\"pwd didnt match\")\n            }\n        }\n  \n}\n\n}"]},"metadata":{},"sourceType":"module"}